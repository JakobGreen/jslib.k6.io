(()=>{"use strict";var r={n:t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},d:(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},t={};r.r(t),r.d(t,{AWSConfig:()=>p,InvalidAWSConfigError:()=>y,InvalidSignatureError:()=>M,S3Client:()=>$,S3ServiceError:()=>V,URIEncodingConfig:()=>U,signHeaders:()=>x});const f=require("k6/crypto");var l=r.n(f);function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function e(n){var r=c();return function(){var t,e=a(n);return t=r?(t=a(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==o(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}}function n(t){var n="function"==typeof Map?new Map:void 0;return function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return i(t,arguments,a(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),u(e,t)}(t)}function i(t,e,n){return(i=c()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);r=new(Function.bind.apply(t,r));return n&&u(r,n.prototype),r}).apply(null,arguments)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var p=function t(e,n,r){if(s(this,t),"string"!=typeof e||""===e)throw new y("invalid AWS region; reason: should be a non empty string");if("string"!=typeof n||""===n)throw new y("invalid AWS access key ID; reason: should be a non empty string");if("string"!=typeof r||""===r)throw new y("invalid AWS secret access key; reason: should be a non empty string");this.region=e,this.accessKeyID=n,this.secretAccessKey=r},y=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(o,n(Error));var r=e(o);function o(){s(this,o);for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return r.call.apply(r,[this].concat(e))}return o}();const h=require("k6/html");function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function m(n){var r=w();return function(){var t,e=j(n);return t=r?(t=j(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==d(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}}function g(t){var n="function"==typeof Map?new Map:void 0;return function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return v(t,arguments,j(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),O(e,t)}(t)}function v(t,e,n){return(v=w()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);r=new(Function.bind.apply(t,r));return n&&O(r,n.prototype),r}).apply(null,arguments)}function w(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function O(t,e){return(O=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function j(t){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&O(t,e)}(o,g(Error));var t,e,n,r=m(o);function o(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=r.call(this,t)).name="AWSError",t.code=e,t}return t=o,n=[{key:"parseXML",value:function(t){t=(0,h.parseHTML)(t);return new o(t.find("Message").text(),t.find("Code").text())}}],(e=null)&&b(t.prototype,e),n&&b(t,n),o}();function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function C(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=n){var r,o,i=[],c=!0,u=!1;try{for(n=n.call(t);!(c=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);c=!0);}catch(t){u=!0,o=t}finally{try{c||null==n.return||n.return()}finally{if(u)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return E(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function R(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T(t,e){return(T=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function A(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=P(n);return t=r?(t=P(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==S(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}}function P(t){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function x(t,e,n,r,o,i,c,u,a){var s=function(t,e,n,r){e=L(e),e=(0,f.hmac)("sha256","AWS4"+t,e,"binary"),n=(0,f.hmac)("sha256",e,n,"binary"),r=(0,f.hmac)("sha256",n,r,"binary");return(0,f.hmac)("sha256",r,"aws4_request","binary")}(c.secretAccessKey,e,c.region,u),n=function(t,e,n,r,o,i){t=t.toUpperCase(),e=function(t,e){if("/"==t)return t;var n=t;"/"==t[t.length-1]&&"/"!=n[n.length-1]&&(n+="/");return n=D(n,e.path),e.double?D(n,e.path):n}(e,i),i=function(t){if(!t)return"";"string"==typeof t&&(t=function(t){if("string"!=typeof t||0===t.length)return{};for(var e={},n=t.split("&").filter(function(t){return t}),r=0;r<n.length;r++){var o=n[r].split("=");2===o.length?e[decodeURIComponent(o[0])]=decodeURIComponent(o[1]):e[decodeURIComponent(n[r])]=""}return e}(t));return Object.keys(t).sort().map(function(e){return(Array.isArray(t[e])?t[e]:[t[e]]).sort().map(function(t){return encodeURIComponent(e)+"="+encodeURIComponent(t)}).join("&")}).join("&")}(n),n=function(t){return t.constructor===Object&&0!==Object.entries(t).length?Object.entries(t).map(function(t){var e=C(t,2),t=e[0],e=e[1];return t.toLowerCase().trim()+":"+(Array.isArray(e)?e:[e]).map(function(t){return t.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"")}).join(",")+"\n"}).sort().join(""):""}(r),r=q(r),o=function(t){return t!==I?l().sha256(t||"","hex").toLowerCase():t}(o);return[t,e,i,n,r,o].join("\n")}(n,r,o,t,i,a),a=(r=e,o=c.region,i=u,a=(0,f.sha256)(n,"hex"),n=z(r),i=H(r,o,i),[k,n,i,a].join("\n")),e=H(e,c.region,u),u=q(t),a=(s=s,a=a,(0,f.hmac)("sha256",s,a,"hex")),a="".concat(k," Credential=").concat(c.accessKeyID,"/").concat(e,", SignedHeaders=").concat(u,", Signature=").concat(a);return t.Authorization=a,t}var M=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&T(t,e)}(r,_);var n=A(r);function r(t,e){return R(this,r),(e=n.call(this,t,e)).name="InvalidSignatureError",e}return r}();var k="AWS4-HMAC-SHA256",I="UNSIGNED-PAYLOAD";function H(t,e,n){return[L(t),e,n,"aws4_request"].join("/")}function q(t){if(t.constructor!==Object)throw new TypeError("headers should be an object");if(0===Object.entries(t).length)throw"headers should at least contain either the Host (HTTP 1.1) or :authority (HTTP 2) parameter";return Object.keys(t).map(function(t){return t.toLowerCase().trim()}).sort().join(";")}function D(t,n){return""==t?t:t.split("").map(function(t){return"A"<=(e=t)&&e<="Z"||"a"<=e&&e<="z"||"0"<=(e=t)&&e<="9"||"-._~".includes(t)?t:" "==t?"%20":"/"==t&&n?"/":"%"+t.charCodeAt(0).toString(16).toUpperCase();var e}).join("")}var U=function t(e,n){R(this,t),this.double=e,this.path=n};function z(t){return new Date(t).toISOString().replace(/[:\-]|\.\d{3}/g,"")}function L(t){return z(t).substring(0,8)}var N=require("k6/http"),B=r.n(N);function W(t){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Y(t,e){return(Y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function G(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=F(n);return t=r?(t=F(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),e=this,!(t=t)||"object"!==W(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}}function F(t){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function K(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function X(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Z,$=function(){function e(t){K(this,e),this.awsConfig=t,this.serviceName="s3",this.URIencodingConfig=new U(!1,!0)}var t,n,r;return t=e,(n=[{key:"listBuckets",value:function(){var t="".concat(this.serviceName,".").concat(this.awsConfig.region,".amazonaws.com"),e=this._buildRequest("GET",t,"/","","",{}),t=e.url,e=e.headers,e=B().request("GET",t,"",{headers:e});this._handle_error(e.error_code,e.error,e.body);var r=[];return(0,h.parseHTML)(e.body).find("Buckets").children().each(function(t,e){var n=new J;e.children().forEach(function(t){switch(t.nodeName()){case"name":Object.assign(n,{name:t.textContent()});case"creationdate":var e=Date.parse(t.textContent(),"YYYY-MM-ddTHH:mm:ss.sssZ");Object.assign(n,{creationDate:e})}}),r.push(n)}),r}},{key:"listObjects",value:function(t){var e="".concat(t,".").concat(this.serviceName,".").concat(this.awsConfig.region,".amazonaws.com"),t=this._buildRequest("GET",e,"/","list-type=2","",{}),e=t.url,t=t.headers,t=B().request("GET",e,"",{headers:t});this._handle_error(t.error_code,t.error,t.body);var r=[];return(0,h.parseHTML)(t.body).find("Contents").each(function(t,e){var n=new Q;e.children().forEach(function(t){switch(t.nodeName()){case"key":Object.assign(n,{key:t.textContent()});case"lastmodified":var e=Date.parse(t.textContent(),"YYYY-MM-ddTHH:mm:ss.sssZ");Object.assign(n,{lastModified:e});case"etag":Object.assign(n,{etag:t.textContent()});case"size":Object.assign(n,{size:parseInt(t.textContent())});case"storageclass":Object.assign(n,{storageClass:t.textContent()})}}),r.push(n)}),r}},{key:"getObject",value:function(t,e){var n="".concat(t,".").concat(this.serviceName,".").concat(this.awsConfig.region,".amazonaws.com"),t="/".concat(e),n=this._buildRequest("GET",n,t,"","",{}),t=n.url,n=n.headers,n=B().request("GET",t,"",{headers:n});return this._handle_error(n.error_code,n.error,n.body),new Q(e,n.headers["Last-Modified"],n.headers.ETag,n.headers["Content-Length"],"",n.body)}},{key:"putObject",value:function(t,e,n){t="".concat(t,".").concat(this.serviceName,".").concat(this.awsConfig.region,".amazonaws.com"),e="/".concat(e),t=this._buildRequest("PUT",t,e,"",n,{}),e=t.url,t=t.headers,t=B().request("PUT",e,n,{headers:t});this._handle_error(t.error_code,t.error,t.body)}},{key:"deleteObject",value:function(t,e){t="".concat(t,".").concat(this.serviceName,".").concat(this.awsConfig.region,".amazonaws.com"),e="/".concat(e),t=this._buildRequest("DELETE",t,e,"","",{}),e=t.url,t=t.headers,t=B().request("DELETE",e,"",{headers:t});this._handle_error(t.error_code,t.error,t.body)}},{key:"_buildRequest",value:function(t,e,n,r,o,i){var c=Date.now(),u=z(c);i.Host=e,i["X-Amz-Date"]=u,i["X-Amz-Content-SHA256"]=(0,f.sha256)(o,"hex"),i=x(i,c,t,n,r,o,this.awsConfig,this.serviceName,this.URIencodingConfig),n=""!==n?n:"/";n="https://".concat(e).concat(n);return""!==r&&(n+="?".concat(r)),{url:n,headers:i}}},{key:"_handle_error",value:function(t,e,n){if(""!=e&&0!==t){if(e&&e.startsWith("301"))throw console.log("HERE"),new V("Resource not found","ResourceNotFound","getObject");n=_.parseXML(n);if("AuthorizationHeaderMalformed"!==n.code)throw new V(n.message,n.code,"listObjects");throw new M(n.message,n.code)}}}])&&X(t.prototype,n),r&&X(t,r),e}(),J=function t(e,n){K(this,t),this.name=e,this.creationDate=n},Q=function t(e,n,r,o,i){var c=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null;K(this,t),this.key=e,this.lastModified=n,this.etag=r,this.size=o,this.storageClass=i||"",this.data=c},V=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Y(t,e)}(o,_);var r=G(o);function o(t,e,n){return K(this,o),(e=r.call(this,t,e)).name="S3ServiceError",e.operation=n,e}return o}(),tt=exports;for(Z in t)tt[Z]=t[Z];t.__esModule&&Object.defineProperty(tt,"__esModule",{value:!0})})();